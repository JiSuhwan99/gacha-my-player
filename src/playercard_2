<template>
    <div class="card-container" :class="[`size-${size}`]" :style="sizeStyle">
        <div class="card-scene" @mousemove="onMove" @mouseleave="onLeave">
            <div class="metal-card-frame" ref="cardRef">

                <div class="metal-surface">
                    <div class="brushed-texture"></div>
                    <div class="radial-shimmer"></div>
                </div>

                <div class="engraved-layer">
                    <div class="header-raw">
                        <div class="ovr-engraved">
                            <span class="num">{{ player.rating }}</span>
                            <span class="unit">OVR</span>
                        </div>
                        <div class="pos-engraved">{{ player.position }}</div>
                    </div>

                    <div class="photo-vault">
                        <img :src="player.img" class="metal-player-img" @error="onImgError" />
                        <div class="hologram-overlay"></div>
                    </div>

                    <div class="footer-plate">
                        <div class="name-engraving">
                            <h1 class="p-name">{{ size === 'xs' ? player.lastName : player.name }}</h1>
                            <div class="divider-line"></div>
                            <p class="p-club">{{ player.club }}</p>
                        </div>

                        <div class="tech-specs" v-if="size !== 'xs' && size !== 's'">
                            <div class="spec">
                                <span class="label">출생</span>
                                <span class="val">{{ player.birth }}</span>
                            </div>
                            <div class="spec">
                                <span class="label">시즌</span>
                                <span class="val">{{ player.season }}</span>
                            </div>
                        </div>

                        <div class="chips-row" v-if="size !== 'xs' && size !== 's'">
                            <span class="m-chip">{{ player.subPos1 }}</span>
                            <span class="m-chip">{{ player.subPos2 }}</span>
                        </div>
                    </div>
                </div>

                <div class="liquid-reflect" ref="reflectRef"></div>
            </div>
        </div>
    </div>
</template>

<script setup>
    import { ref, computed, defineProps } from 'vue';
    import { gsap } from 'gsap';

    const props = defineProps({
        size: { type: String, default: 'l' },
        player: {
            type: Object,
            default: () => ({
                rating: 91,
                name: "브루누 실바",
                club: "수원 삼성 블루윙즈",
                position: "FW",
                season: "2026",
                subPos1: "WF",
                subPos2: "WM",
                birth: "1992.07.08",
                img: "/public/images/unknown_player.png"
            })
        }
    });

    const cardRef = ref(null);
    const reflectRef = ref(null);

    const widthMap = { xl: 380, l: 320, m: 240, s: 180, xs: 130 };
    const sizeStyle = computed(() => ({
        '--card-w': `${widthMap[props.size]}px`,
        fontSize: `${widthMap[props.size] / 320}rem`
    }));

    const onMove = (e) => {
        if (!cardRef.value) return;
        const rect = cardRef.value.getBoundingClientRect();
        const x = (e.clientX - rect.left) / rect.width - 0.5;
        const y = (e.clientY - rect.top) / rect.height - 0.5;

        gsap.to(cardRef.value, {
            rotationY: x * 40,
            rotationX: -y * 40,
            duration: 0.4,
            ease: "power2.out",
            transformPerspective: 1000
        });

        // 액체 같은 금속 반사광 이동
        gsap.to(reflectRef.value, {
            opacity: 1,
            background: `linear-gradient(${x * 100 + 135}deg, rgba(255,255,255,0) 20%, rgba(255,255,255,0.6) 50%, rgba(255,255,255,0) 80%)`,
            duration: 0.2
        });
    };

    const onLeave = () => {
        gsap.to(cardRef.value, { rotationY: 0, rotationX: 0, duration: 1.2, ease: "elastic.out(1, 0.3)" });
        gsap.to(reflectRef.value, { opacity: 0 });
    };
</script>

<style scoped>
    @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Syncopate:wght@700&family=Roboto+Mono:wght@700&display=swap');

    * {
        line-height: 1;
    }

    .card-container {
        display: inline-block;
        perspective: 1500px;
        margin: 250px 800px;
    }

    .card-scene {
        width: var(--card-w);
    }

    .metal-card-frame {
        width: 100%;
        aspect-ratio: 1 / 1.55;
        position: relative;
        background: linear-gradient(45deg,
                #999 5%,
                #fff 10%,
                #ccc 30%,
                #ddd 50%,
                #ccc 70%,
                #fff 80%,
                #999 95%);
        border-radius: 0.8em;
        padding: 0.3em;
        overflow: hidden;
        transform-style: preserve-3d;
        box-shadow: 0 40px 80px rgba(0, 0, 0, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* 1. 금속 표면 구현 */
    .metal-surface {
        position: absolute;
        inset: 0.3em;
        background-color: #050505;
        background-image: linear-gradient(115deg, transparent 75%, #111 75%), linear-gradient(245deg, transparent 75%, #111 75%), linear-gradient(115deg, transparent 75%, #111 75%), linear-gradient(245deg, transparent 75%, #111 75%);
        background-position: 0 0, 0 0, 15px -30px, 15px -30px;
        background-size: 30px 60px;
        border-radius: 0.6em;
        overflow: hidden;
        z-index: 1;
    }

    .brushed-texture {
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, #2c2c2c 0%, #111 50%, #2c2c2c 100%);
        background-image: repeating-linear-gradient(0deg, rgba(255, 255, 255, 0.03) 0px, rgba(255, 255, 255, 0.03) 1px, transparent 1px, transparent 2px);
        opacity: 0.8;
    }

    /* 2. 에칭 레이아웃 */
    .engraved-layer {
        position: relative;
        z-index: 5;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .header-raw {
        display: flex;
        justify-content: space-between;
        padding: 1.5em 1.5em 0.8em;
        align-items: flex-start;
    }

    .ovr-engraved {
        font-family: 'Oswald', sans-serif;
        color: #fff;
        line-height: 0.8;
    }

    .ovr-engraved .num {
        font-size: 4.5em;
        font-weight: 700;
        letter-spacing: -2px;
    }

    .ovr-engraved .unit {
        font-size: 1.2em;
        opacity: 0.5;
        margin-left: 0.2em;
    }

    .pos-engraved {
        font-family: 'Syncopate', sans-serif;
        font-size: 1.2em;
        color: #fff;
        border: 1px solid #444;
        padding: 0.3em 0.8em;
        background: rgba(255, 255, 255, 0.05);
    }

    /* 사진 영역 */
    .photo-vault {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: flex-end;
        position: relative;
        max-height: 25%;
    }

    .metal-player-img {
        height: 105%;
        object-fit: contain;
        filter: grayscale(0.5) contrast(1.2) drop-shadow(0 10px 30px #000);
        z-index: 6;
    }

    /* 하단 각인 플레이트 */
    .footer-plate {
        background: linear-gradient(to top, #000 80%, transparent);
        padding: 0.8em 1.5em 1.5em;
        text-align: center;
        margin: auto 0 0;
    }

    .name-engraving .p-name {
        font-family: 'Hahmlet', sans-serif;
        font-size: 2em;
        color: #eee;
        margin: 0;
        letter-spacing: 1px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        font-weight: 600;
    }

    .divider-line {
        width: 80px;
        height: 2px;
        background: #666;
        margin: 10px auto;
    }

    .p-club {
        font-family: 'Hahmlet', sans-serif;
        font-size: 0.8em;
        color: #888;
        text-transform: uppercase;
    }

    .tech-specs {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 15px;
        border-top: 1px solid #222;
        padding-top: 15px;
    }

    .tech-specs .spec {
        width: 50%;
    }

    .spec .label {
        display: block;
        font-size: 0.55em;
        color: #555;
        margin-bottom: 2px;
    }

    .spec .val {
        font-family: 'Roboto Mono', monospace;
        font-size: 0.85em;
        color: #ccc;
    }

    .chips-row {
        margin-top: 15px;
        display: flex;
        justify-content: center;
        gap: 8px;
    }

    .m-chip {
        background: #1a1a1a;
        border: 1px solid #333;
        color: #777;
        padding: 0.2em 0.8em;
        font-size: 0.8em;
        font-family: 'Roboto Mono', monospace;
    }

    /* 액체 금속 반사광 */
    .liquid-reflect {
        position: absolute;
        inset: 0;
        z-index: 10;
        pointer-events: none;
        opacity: 0;
        mix-blend-mode: overlay;
    }
</style>